import{d as re,l as _e,v as ye,u as e,o as i,c,n as Y,p as xe,r as L,C as I,a as l,m as ve,w as a,b as s,h as D,t as f,e as o,f as B,F as S,i as A,g as V,j as ge}from"./app-e_9mTgsV.js";import{_ as be,K as b}from"./AppLayout.vue_vue_type_script_setup_true_lang-DtbnEB1D.js";import{_ as K,a as we,b as j,c as O,d as P,e as Q,f as H}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-3LyEYAR8.js";import{_ as R,a as Z,b as G,c as J,d as W,e as X,f as E}from"./SelectValue.vue_vue_type_script_setup_true_lang-BUn1WxWe.js";import{_ as Se,a as Ve,b as M,c as y,d as $e,e as m,C as Ce,P as ke,T as Fe}from"./TableHeader.vue_vue_type_script_setup_true_lang-DuwJ1ElH.js";import{c as oe,a as qe,_ as w}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CPDCbYeG.js";import{_ as $,a as se}from"./Label.vue_vue_type_script_setup_true_lang-BAu2IL4Q.js";import{u as Ae,a as Ne}from"./useQuery-Djd7vjk-.js";import{u as De}from"./useForwardExpose-BVB12uKL.js";import{L as Ee}from"./loader-circle-BwJZBnU6.js";import"./RovingFocusGroup-D4fH2I_q.js";import"./check-scssBgGg.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=oe("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=oe("FileTextIcon",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),Te=re({__name:"Textarea",props:{class:{},defaultValue:{},modelValue:{}},emits:["update:modelValue"],setup(x,{emit:_}){const C=x,k=De(C,"modelValue",_,{passive:!0,defaultValue:C.defaultValue});return(te,h)=>_e((i(),c("textarea",{"onUpdate:modelValue":h[0]||(h[0]=p=>xe(k)?k.value=p:null),"data-slot":"textarea",class:Y(e(qe)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",C.class))},null,2)),[[ye,e(k)]])}}),Ue={class:"p-6 space-y-6"},ze={class:"flex w-full justify-between items-center"},Le={key:0},Ie={class:"flex-1 text-md font-bold"},Be={class:"flex flex-col space-y-1"},Ke={class:"flex flex-col space-y-1"},je={class:"flex flex-col space-y-1"},Oe={class:"flex flex-col space-y-1"},Pe={class:"space-y-3"},Qe=["onClick"],He={class:"flex flex-col space-y-1"},Re={class:"grid gap-4 py-4"},Ze={class:"grid grid-cols-4 items-center gap-4"},Ge={class:"text-center text-green-500 flex items-center justify-center"},Je={class:"text-center text-red-500 flex items-center justify-center"},We={class:"text-nowrap"},Xe={class:"text-nowrap"},Ye={class:"text-nowrap"},et={class:"text-nowrap"};function tt(x,_=50){return x.length<=_?x:x.slice(0,_).trim()+"..."}const pt=re({__name:"Files",props:{id:{}},setup(x){const _=Ae(),C=[{title:"Files",href:"/admin/files"}],ee=x,k=async()=>(await ge.post("/graphql",{query:`
    query ($id: String!) {
      files (id: $id) {
        categoryName {
            encrypted_id
            category
        }
        authors {
            encrypted_id
            name
        }     
        filesList {
            encrypted_id
            title
            ordinanceNumber
            municipalStatus
            provincialStatus
            author {
                name
            }  
            coAuthors {
                official {
                    name
                }
            }
        }
      }
    }
  `,variables:{id:ee.id}})).data.data,{isPending:te,error:h,data:p,isFetching:le,isLoading:ae}=Ne({queryKey:["fetchFiles"],queryFn:k}),N=L(!1);function ne(v){u.categoryID=v,N.value=!0}const u=I({categoryID:"",municipalStatus:"",title:"",author:"",coauthor:[],file:null}),ue=()=>{u.coauthor.push("")},ie=v=>{u.coauthor.splice(v,1)},de=()=>{u.post(route("create.file"),{onSuccess:()=>{b.success("File created and uploaded successfully"),u.reset(),N.value=!1,_.invalidateQueries({queryKey:["fetchFiles"]})},onError:()=>{b.error("Error creating file"),console.error("Error")}})},T=L(!1),F=I({id:"",category:""}),fe=()=>{F.patch(route("update.category"),{onSuccess:()=>{b.success("Category updated successfully"),F.reset(),T.value=!1,_.invalidateQueries({queryKey:["fetchFiles"]})},onError:()=>{b.error("Error updating category"),console.error("Error")}})},U=L(!1),z=I({id:""}),me=()=>{z.delete(route("delete.category"),{onSuccess:()=>{b.success("Category deleted successfully"),z.reset(),U.value=!1,_.invalidateQueries({queryKey:["fetchFiles"]})},onError:()=>{b.error("Deletion Error"),console.error("Error")}})},ce=async v=>{var n;const t=v.target,g=(n=t.files)==null?void 0:n[0];if(!g)return;const d=2*1024*1024;g.size>d&&(t.value="",b.error("File too large. Please select a smaller file.")),u.file=g,console.log("Selected file:",g)};return(v,t)=>(i(),c(S,null,[l(e(ve),{title:"Files"}),l(be,{breadcrumbs:C},{default:a(()=>{var g;return[s("div",Ue,[s("div",ze,[s("div",null,[!e(ae)&&!e(le)?(i(),c("div",Le,[s("h6",Ie,f((g=e(p))==null?void 0:g.files.categoryName.category),1)])):D("",!0)]),l(e(K),{open:N.value,"onUpdate:open":t[4]||(t[4]=r=>N.value=r)},{default:a(()=>[l(e(we),{"as-child":""},{default:a(()=>[l(e(w),{onClick:t[0]||(t[0]=r=>{var d;return ne((d=e(p))==null?void 0:d.files.categoryName.encrypted_id)}),class:"cursor-pointer"},{default:a(()=>t[8]||(t[8]=[o(" + New ")])),_:1})]),_:1}),l(e(j),{class:"sm:max-w-[800px] w-full"},{default:a(()=>[l(e(O),null,{default:a(()=>[l(e(P),null,{default:a(()=>t[9]||(t[9]=[o("Add New File")])),_:1}),l(e(Q),null,{default:a(()=>{var r;return[t[10]||(t[10]=o(" Create a new file for ")),s("b",null,f((r=e(p))==null?void 0:r.files.categoryName.category),1)]}),_:1})]),_:1}),s("form",{onSubmit:B(de,["prevent"]),class:"space-y-6"},[s("div",Be,[l(e($),{class:"text-sm font-medium text-gray-700"},{default:a(()=>t[11]||(t[11]=[o("Municipal Status")])),_:1}),l(e(R),{modelValue:e(u).municipalStatus,"onUpdate:modelValue":t[1]||(t[1]=r=>e(u).municipalStatus=r),required:""},{default:a(()=>[l(e(Z),{class:"w-full"},{default:a(()=>[l(e(G),{placeholder:"Select a status"})]),_:1}),l(e(J),null,{default:a(()=>[l(e(W),null,{default:a(()=>[l(e(X),null,{default:a(()=>t[12]||(t[12]=[o("Status")])),_:1}),l(e(E),{value:"1"},{default:a(()=>t[13]||(t[13]=[o("Draft Ordinance")])),_:1}),l(e(E),{value:"2"},{default:a(()=>t[14]||(t[14]=[o("Approved Ordinance")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Ke,[l(e($),{class:"text-sm font-medium text-gray-700"},{default:a(()=>t[15]||(t[15]=[o("Title of Ordinance")])),_:1}),l(e(Te),{modelValue:e(u).title,"onUpdate:modelValue":t[2]||(t[2]=r=>e(u).title=r),class:"w-full"},null,8,["modelValue"])]),s("div",je,[l(e($),{class:"text-sm font-medium text-gray-700"},{default:a(()=>t[16]||(t[16]=[o("Author")])),_:1}),l(e(R),{modelValue:e(u).author,"onUpdate:modelValue":t[3]||(t[3]=r=>e(u).author=r),required:""},{default:a(()=>[l(e(Z),{class:"w-full"},{default:a(()=>[l(e(G),{placeholder:"Select an author"})]),_:1}),l(e(J),null,{default:a(()=>{var r;return[l(e(X),null,{default:a(()=>t[17]||(t[17]=[o("Authors")])),_:1}),(i(!0),c(S,null,A((r=e(p))==null?void 0:r.files.authors,d=>(i(),V(e(W),null,{default:a(()=>[l(e(E),{value:d.encrypted_id},{default:a(()=>[o(f(d.name),1)]),_:2},1032,["value"])]),_:2},1024))),256))]}),_:1})]),_:1},8,["modelValue"])]),s("div",Oe,[l(e($),{class:"text-sm font-medium text-gray-700"},{default:a(()=>t[18]||(t[18]=[o("Co Authors")])),_:1}),s("div",Pe,[(i(!0),c(S,null,A(e(u).coauthor,(r,d)=>(i(),c("div",{key:d,class:"flex items-center gap-2"},[l(e(R),{modelValue:e(u).coauthor[d],"onUpdate:modelValue":n=>e(u).coauthor[d]=n,required:""},{default:a(()=>[l(e(Z),{class:"w-full"},{default:a(()=>[l(e(G),{placeholder:"Select an author"})]),_:1}),l(e(J),null,{default:a(()=>[l(e(X),null,{default:a(()=>t[19]||(t[19]=[o("Authors")])),_:1}),l(e(W),null,{default:a(()=>{var n;return[(i(!0),c(S,null,A((n=e(p))==null?void 0:n.files.authors,q=>(i(),V(e(E),{key:q.encrypted_id,value:q.encrypted_id},{default:a(()=>[o(f(q.name),1)]),_:2},1032,["value"]))),128))]}),_:1})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),s("button",{type:"button",onClick:n=>ie(d),class:"text-red-500 hover:text-red-700 text-sm cursor-pointer"}," âœ• ",8,Qe)]))),128)),s("button",{type:"button",onClick:ue,class:"text-blue-500 hover:text-blue-700 text-sm cursor-pointer"}," + Add ")])]),s("div",He,[l(e($),{class:"text-sm font-medium text-gray-700"},{default:a(()=>t[20]||(t[20]=[o("Upload a File")])),_:1}),l(e(se),{type:"file",class:"col-span-3",onChange:ce,accept:".pdf",required:""})]),l(e(H),null,{default:a(()=>[l(e(w),{type:"submit",class:"cursor-pointer",disabled:e(u).processing},{default:a(()=>t[21]||(t[21]=[o(" Save ")])),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),l(e(K),{open:T.value,"onUpdate:open":t[6]||(t[6]=r=>T.value=r)},{default:a(()=>[l(e(j),{class:"sm:max-w-[600px]"},{default:a(()=>[l(e(O),null,{default:a(()=>[l(e(P),null,{default:a(()=>t[22]||(t[22]=[o("Edit Category")])),_:1}),l(e(Q),null,{default:a(()=>t[23]||(t[23]=[o(" Edit the details of the selected category ")])),_:1})]),_:1}),s("form",{action:"",onSubmit:B(fe,["prevent"])},[s("div",Re,[s("div",Ze,[l(e($),{class:"text-right"},{default:a(()=>t[24]||(t[24]=[o("Category")])),_:1}),l(e(se),{modelValue:e(F).category,"onUpdate:modelValue":t[5]||(t[5]=r=>e(F).category=r),placeholder:"Category Name",class:"col-span-3",required:""},null,8,["modelValue"])])]),l(e(H),null,{default:a(()=>[l(e(w),{type:"submit",class:"cursor-pointer",disabled:e(F).processing},{default:a(()=>t[25]||(t[25]=[o("Save")])),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),l(e(K),{open:U.value,"onUpdate:open":t[7]||(t[7]=r=>U.value=r)},{default:a(()=>[l(e(j),{class:"sm:max-w-[600px]"},{default:a(()=>[l(e(O),null,{default:a(()=>[l(e(P),null,{default:a(()=>t[26]||(t[26]=[o("Delete Official")])),_:1}),l(e(Q),null,{default:a(()=>t[27]||(t[27]=[o(" Are you sure you want to delete this official? This action cannot be undone. ")])),_:1})]),_:1}),s("form",{action:"",onSubmit:B(me,["prevent"])},[l(e(H),null,{default:a(()=>[l(e(w),{type:"submit",class:"cursor-pointer",variant:"destructive",disabled:e(z).processing},{default:a(()=>t[28]||(t[28]=[o("Delete")])),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"])]),l(e(Se),null,{default:a(()=>[l(e(Ve),null,{default:a(()=>[l(e(M),null,{default:a(()=>[l(e(y),{class:"w-[50px]"},{default:a(()=>t[29]||(t[29]=[s("small",null,"#",-1)])),_:1}),l(e(y),{class:"w-[50px]"},{default:a(()=>t[30]||(t[30]=[s("small",null,"File",-1)])),_:1}),l(e(y),{class:"w-[300px]"},{default:a(()=>t[31]||(t[31]=[s("small",null,"Title",-1)])),_:1}),l(e(y),null,{default:a(()=>t[32]||(t[32]=[s("small",null,"Ordinance Number",-1)])),_:1}),l(e(y),null,{default:a(()=>t[33]||(t[33]=[s("small",null,"Author",-1)])),_:1}),l(e(y),null,{default:a(()=>t[34]||(t[34]=[s("small",null,"Mun. Status",-1)])),_:1}),l(e(y),null,{default:a(()=>t[35]||(t[35]=[s("small",null,"Prov. Status",-1)])),_:1}),l(e(y),{class:"text-right"},{default:a(()=>t[36]||(t[36]=[s("small",null,"Actions",-1)])),_:1})]),_:1})]),_:1}),!e(ae)&&!e(le)?(i(),V(e($e),{key:0},{default:a(()=>{var r,d;return[e(te)?(i(),V(e(M),{key:0},{default:a(()=>[l(e(m),{colspan:"10",class:"text-center"},{default:a(()=>[s("small",Ge,[l(e(Ee),{class:"mr-2 w-5"}),t[37]||(t[37]=o(" Loading... "))])]),_:1})]),_:1})):D("",!0),((r=e(p))==null?void 0:r.files.filesList.length)==0?(i(),V(e(M),{key:1},{default:a(()=>[l(e(m),{colspan:"10"},{default:a(()=>[s("small",Je,[l(e(Ce),{class:"mr-2 w-5"}),t[38]||(t[38]=o(" No Data Found "))])]),_:1})]),_:1})):D("",!0),(i(!0),c(S,null,A((d=e(p))==null?void 0:d.files.filesList,(n,q)=>(i(),V(e(M),{key:n.encrypted_id},{default:a(()=>[l(e(m),null,{default:a(()=>[s("small",null,f(q+1),1)]),_:2},1024),l(e(m),null,{default:a(()=>[l(e(he),{class:"w-5 h-5 text-green-500"})]),_:1}),l(e(m),{class:"pr-5"},{default:a(()=>[s("div",We,f(tt(n.title)),1)]),_:2},1024),l(e(m),null,{default:a(()=>[s("small",Xe,f(n.ordinanceNumber!=null?n.ordinanceNumber:"-"),1)]),_:2},1024),l(e(m),{class:"pr-5"},{default:a(()=>[s("div",Ye,[s("b",null,f(n.author.name),1)]),t[39]||(t[39]=s("div",null,[s("small",{class:"text-blue-500"},"Co Authors:")],-1)),(i(!0),c(S,null,A(n.coAuthors,pe=>(i(),c("div",null,[s("small",et,f(pe.official.name),1)]))),256))]),_:2},1024),l(e(m),null,{default:a(()=>[s("small",{class:Y(n.municipalStatus==1?"text-wrap text-red-500":"text-wrap text-green-500")},f(n.municipalStatus==1?"Draft":"Approved"),3)]),_:2},1024),l(e(m),null,{default:a(()=>[s("small",{class:Y(n.provincialStatus===1?"text-wrap text-red-500":n.provincialStatus===2?"text-wrap text-green-500":"text-wrap text-gray-500")},f(n.provincialStatus===null?"-":n.provincialStatus===1?"Draft":"Approved"),3)]),_:2},1024),l(e(m),{class:"text-right"},{default:a(()=>[l(e(w),{variant:"link",class:"ml-0 cursor-pointer"},{default:a(()=>[l(e(Me))]),_:1}),l(e(w),{variant:"link",class:"ml-0 cursor-pointer"},{default:a(()=>[l(e(ke))]),_:1}),l(e(w),{variant:"destructive",class:"ml-0 cursor-pointer"},{default:a(()=>[l(e(Fe))]),_:1})]),_:1})]),_:2},1024))),128))]}),_:1})):D("",!0)]),_:1})])]}),_:1})],64))}});export{pt as default};
